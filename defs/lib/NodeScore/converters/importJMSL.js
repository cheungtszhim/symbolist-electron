const testXML = `<?xml version="1.0"?> <jmslscoredoc> <!-- Saved document from JMSL's programmable music notation editor. Java Music Specification Language by Nick Didkovsky & Phil Burk, available from: http://www.algomusic.com --> <score NAME="JMSLMaxScore-8" SUBTITLE="" COMPOSER="" COPYRIGHT="" WIDTH="800" HEIGHT="800" STAFFS="1" NUMTRACKSPERSTAFF="4" InstrumentNamesVisible="false" TempoVisible="true" StaffNumbersVisible="true" MeasureNumbersVisible="true" SectionBracketsVisible="true" TimeSignaturesVisible="true" KeySignaturesVisible="true" ClefsVisible="true" ScoreTitleVisible="false" CourtesyClefsVisible="false" MeasureNumberOffset="1" LeftMargin="20.0" RightMargin="20.0" TopMargin="15.0" BottomMargin="15.0" TopMarginOfFirstPage="60.0" DrawAllMeasureNumbers="false" TextFontScaler="1.5" ScoreSubtitleFontScaler="2.0" ScoreTitleFontScaler="4.0" TimesigFontScaler="2.5" MeasureNumberFontScaler="1.5" TextFontName="SansSerif" ScoreSubtitleFontName="Serif" ScoreTitleFontName="Serif" TimesigFontName="Serif" MeasureNumberFontName="SansSerif" FirstSystemIndent="0.0" useLegacyMultiTrackOrientation="true" > <ScoreAnnotation CLASSNAME="com.softsynth.jmsl.score.ScoreAnnotation" Annotation="316.3ocUPtzSCCCDD9bxuBKeNMxUhGpbipdgCTp3gPBDGbRsiL01azZmBnp9eG+nMDtXK+siGMydnrftWfNEXojaHz40LZUf0iPOf9.lqiCXQXila2sg2IFIdkQ7hU4if4LVcFJ91KAaBRuEUAGhXyfS0NxWh78CHmlcwqEiSdN3oirV7E4QvvsIEMcsfFv372Ir5EKtpZx0EUjPtIeDUJ+uRV0jiQQNg+Uj2mR8o2uAfIUq5KOQVEhWdA7TOuUY6Vxc4lWecRhmKkyXQRwgxhBpVrsSfZkU3N6bT0O5zunqDR9f1SSXipECsKEAp49YVvJxS3a+bv4OugKnsgUSR01o+OEsYZ.1Mz+m1Tj5PHyB8OT7TiC11zf2YcdbM2jyCI6jJBGLBqONYC3TwR+fTFVAImKKNVVdr7W.K.VkGB" > </ScoreAnnotation> <orchestra CLASSNAME="com.softsynth.jmsl.score.Orchestra" > <jmslscoreinstrument CLASSNAME="com.algomusic.max.MaxScoreInstrument" InsIndex="0" EditEnabled="true" Name="MaxScoreIns-0" MixerClassName="com.softsynth.jmsl.NullMixer" Transposition="0.0" > <dim index="4" defaultvalue="0.0" lowlimit="0.0" highlimit="3.0" name="EventFlag" /> <dim index="5" defaultvalue="-1.0" lowlimit="-1.0" highlimit="127.0" name="originalPitch" /> <dim index="6" defaultvalue="-1.0" lowlimit="-1.0" highlimit="10000.0" name="index" /> </jmslscoreinstrument> </orchestra> <mixerpanelsettings > <panamppair FADERINDEX="0" PAN="0.5" AMP="0.5" /> </mixerpanelsettings> <staffspacing INDEX="0" ABOVE="72.0" BELOW="72.0" /> <scoresection NAME="A" START="0" END="0" /> <scoresection NAME="B" START="0" END="0" /> <scoresection NAME="C" START="0" END="0" /> <scoresection NAME="D" START="0" END="0" /> <scoresection NAME="E" START="0" END="0" /> <scoresection NAME="F" START="0" END="0" /> <scoresection NAME="G" START="0" END="0" /> <scoresection NAME="H" START="0" END="0" /> <scoresection NAME="I" START="0" END="0" /> <scoresection NAME="J" START="0" END="0" /> <scoresection NAME="K" START="0" END="0" /> <scoresection NAME="L" START="0" END="0" /> <scoresection NAME="M" START="0" END="0" /> <scoresection NAME="N" START="0" END="0" /> <scoresection NAME="O" START="0" END="0" /> <scoresection NAME="P" START="0" END="0" /> <scoresection NAME="Q" START="0" END="0" /> <scoresection NAME="R" START="0" END="0" /> <scoresection NAME="S" START="0" END="0" /> <scoresection NAME="T" START="0" END="0" /> <scoresection NAME="U" START="0" END="0" /> <scoresection NAME="V" START="0" END="0" /> <scoresection NAME="W" START="0" END="0" /> <scoresection NAME="X" START="0" END="0" /> <scoresection NAME="Y" START="0" END="0" /> <scoresection NAME="Z" START="0" END="0" /> <measure WIDTH="821" WIDTHSETBYHAND="false" TIMESIG="4 4" TIMESIGSETBYHAND="false" TEMPO="60.0" TEMPOSETBYHAND="false" REPEATSTART="false" REPEATEND="false" NUMREPEATS="1" BARLINE="SINGLE" MEASURETEXT="" MEASURETEXTX="48" MEASURETEXTY="48" MEASURELEFTMARGIN="50.0" > <staff INDEX="0" CLEF="0" CLEFSETBYHAND="false" INSTRUMENTINDEX="0" INSINDEXSETBYHAND="false" KEYSIGTYPE="0" KEYSIGNUMACC="0" KEYSIGSETBYHAND="false" EXTENDEDLINESABOVE="0" EXTENDEDLINESBELOW="0" > <track INDEX="0" MultitrackRestAdjustmentY="0.0" > <note NOTEDUR="2" TUPLET="0" DOTS="0" ACCINFO="0" DURATION="1.0" PITCH="67.0" VELOCITY="0.5" HOLD="0.25" BEAMEDOUT="false" GLISSOUT="false" TIEDOUT="false" ACCPREF="0" ACCVISPOLICY="0" ALTENHARMONIC="false" DYN="0" SLUROUT="false" ISGRACENOTE="false" GRACENOTESEPARATIONSCALER="2.0" LEDGERLINESVISIBLE="true" WEDGE="none" OTTAVA="none" MARK="0" TEXTOFFSETX="0" TEXTOFFSETY="0" NOTEHEAD="0" NOTEHEADSCALE="1.0" VISIBLE="true" NOTEHEADVISIBLE="true" STEMVISIBLE="true" OVERRIDELEVEL="-1" ISOVERRIDELEVEL="false" STEMINFOOVERRIDE="false" STEMINFO="1" LAYOUTSHIFTX="0.0" TEXT="" > <dim index="4" value="0.0" name="EventFlag" /> <dim index="5" value="67.0" name="originalPitch" /> <dim index="6" value="-1.0" name="index" /> </note> <note NOTEDUR="2" TUPLET="0" DOTS="0" ACCINFO="0" DURATION="1.0" PITCH="64.0" VELOCITY="0.5" HOLD="1.0" BEAMEDOUT="false" GLISSOUT="false" TIEDOUT="false" ACCPREF="0" ACCVISPOLICY="0" ALTENHARMONIC="false" DYN="0" SLUROUT="false" ISGRACENOTE="false" GRACENOTESEPARATIONSCALER="2.0" LEDGERLINESVISIBLE="true" WEDGE="none" OTTAVA="none" MARK="0" TEXTOFFSETX="0" TEXTOFFSETY="0" NOTEHEAD="0" NOTEHEADSCALE="1.0" VISIBLE="true" NOTEHEADVISIBLE="true" STEMVISIBLE="true" OVERRIDELEVEL="-1" ISOVERRIDELEVEL="false" STEMINFOOVERRIDE="false" STEMINFO="1" LAYOUTSHIFTX="0.0" TEXT="" > <dim index="4" value="0.0" name="EventFlag" /> <dim index="5" value="64.0" name="originalPitch" /> <dim index="6" value="-1.0" name="index" /> </note> <note NOTEDUR="2" TUPLET="0" DOTS="0" ACCINFO="0" DURATION="1.0" PITCH="74.0" VELOCITY="0.5" HOLD="1.0" BEAMEDOUT="false" GLISSOUT="false" TIEDOUT="false" ACCPREF="0" ACCVISPOLICY="0" ALTENHARMONIC="false" DYN="0" SLUROUT="false" ISGRACENOTE="false" GRACENOTESEPARATIONSCALER="2.0" LEDGERLINESVISIBLE="true" WEDGE="none" OTTAVA="none" MARK="0" TEXTOFFSETX="0" TEXTOFFSETY="0" NOTEHEAD="0" NOTEHEADSCALE="1.0" VISIBLE="true" NOTEHEADVISIBLE="true" STEMVISIBLE="true" OVERRIDELEVEL="-1" ISOVERRIDELEVEL="false" STEMINFOOVERRIDE="false" STEMINFO="2" LAYOUTSHIFTX="0.0" TEXT="" > <dim index="4" value="0.0" name="EventFlag" /> <dim index="5" value="74.0" name="originalPitch" /> <dim index="6" value="-1.0" name="index" /> </note> <note NOTEDUR="2" TUPLET="0" DOTS="0" ACCINFO="0" DURATION="1.0" PITCH="71.0" VELOCITY="0.5" HOLD="1.0" BEAMEDOUT="false" GLISSOUT="false" TIEDOUT="false" ACCPREF="0" ACCVISPOLICY="0" ALTENHARMONIC="false" DYN="0" SLUROUT="false" ISGRACENOTE="false" GRACENOTESEPARATIONSCALER="2.0" LEDGERLINESVISIBLE="true" WEDGE="none" OTTAVA="none" MARK="0" TEXTOFFSETX="0" TEXTOFFSETY="0" NOTEHEAD="0" NOTEHEADSCALE="1.0" VISIBLE="true" NOTEHEADVISIBLE="true" STEMVISIBLE="true" OVERRIDELEVEL="-1" ISOVERRIDELEVEL="false" STEMINFOOVERRIDE="false" STEMINFO="2" LAYOUTSHIFTX="0.0" TEXT="" > <dim index="4" value="0.0" name="EventFlag" /> <dim index="5" value="71.0" name="originalPitch" /> <dim index="6" value="-1.0" name="index" /> </note> </track> <track INDEX="1" MultitrackRestAdjustmentY="0.0" > </track> <track INDEX="2" MultitrackRestAdjustmentY="0.0" > </track> <track INDEX="3" MultitrackRestAdjustmentY="0.0" > </track> </staff> </measure> <measure WIDTH="700" WIDTHSETBYHAND="false" TIMESIG="4 4" TIMESIGSETBYHAND="false" TEMPO="60.0" TEMPOSETBYHAND="false" REPEATSTART="false" REPEATEND="false" NUMREPEATS="1" BARLINE="SINGLE" MEASURETEXT="" MEASURETEXTX="48" MEASURETEXTY="48" MEASURELEFTMARGIN="50.0" > <staff INDEX="0" CLEF="0" CLEFSETBYHAND="false" INSTRUMENTINDEX="0" INSINDEXSETBYHAND="false" KEYSIGTYPE="0" KEYSIGNUMACC="0" KEYSIGSETBYHAND="false" EXTENDEDLINESABOVE="0" EXTENDEDLINESBELOW="0" > <track INDEX="0" MultitrackRestAdjustmentY="0.0" > </track> <track INDEX="1" MultitrackRestAdjustmentY="0.0" > </track> <track INDEX="2" MultitrackRestAdjustmentY="0.0" > </track> <track INDEX="3" MultitrackRestAdjustmentY="0.0" > </track> </staff> </measure> <scoreUserBean CLASSNAME="com.algomusic.max.MaxScoreRenderedMessageListener" > </scoreUserBean> </score> </jmslscoredoc>`;

function importJMSL(path) {
    //const fs = require('fs');
    const xml2json = require('../extensions/xml2json');
    let scoreObj = {
        class: 'Score',
        id: 'Score',
        x: 100,
        y: 40,
        width: 1000,
        height: 500,
        indent: 100,
        contents: []
    };
    //console.log('path = ', path);
    /*fs.readFile(path, 'utf-8', (err, xml) => {
        if (err) console.error(err);
        else {
            console.log('xml read successful: ' + path);
            const jmsl = xml2json.xml2json(xml);
            console.log(jmsl);
        }
    });
    */
    try {
        //console.log('imported XML: '+testXML);
        const jmsl = xml2json.xml2json(testXML);
        //console.log('converted JSON: '+JSON.stringify(jmsl, null, 2));

        const score = jmsl.jmslscoredoc.score;
        if (typeof score.NAME != 'undefined') scoreObj.title = score.NAME;
        let num_staffs = 0;
        if (typeof score.STAFFS != 'undefined') num_staffs = score.STAFFS;

        for (let i = 0; i < num_staffs; i++) {
            scoreObj.contents.push({
                class: 'Part',
                id: `Part_${i}`,
                contents: []
            });
        }

        const measure = score.measure;

        measure.forEach((m,i) => {
            const timesig = m.TIMESIG.split(' ');
            const staff = m.staff;
            scoreObj.contents.forEach((p,j) => {
                let measureStaffObj = {
                    // copy measure in all parts
                    class: 'Measure',
                    id: `Measure_${i}_${j}`,
                    time_signature: [timesig[0],timesig[1]],
                    index: i,
                    // individual StaffClef from m.staff
                    contents: [{
                        class: 'StaffClef',
                        id: `StaffClef_${i}_${j}`,
                        
                    }]
                }
                p.contents.push(measureStaffObj);                
            });


        });

    }
    catch (e) {
        console.error(e);
    }
    return scoreObj;
}

module.exports = {
    importJMSL
}